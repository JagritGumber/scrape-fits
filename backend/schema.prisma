datasource db {
  provider = "sqlite"
  url      = "file:dev.db"
}

generator client {
  provider  = "prisma-client-py"
  interface = "asyncio"
  output    = "orm"
}

model Session {
  id        Int           @id @default(autoincrement())
  createdAt DateTime      @default(now())
  name      String        @default("Untitled session")
  search    SessionSearch?
  results   SessionResult[]
}

model SessionSearch {
  id                   Int       @id @default(autoincrement())
  createdAt            DateTime  @default(now())
  session              Session   @relation(fields: [sessionId], references: [id])
  sessionId            Int       @unique
  query                String
  issuesFilter         String
  maxResultsRequested  Int
  checkedWebsitesCount Int       @default(0)
  lastSearchCursor     String?
  status               String
  completedAt          DateTime?
}

model SessionResult {
  id             Int          @id @default(autoincrement())
  createdAt      DateTime     @default(now())
  session        Session      @relation(fields: [sessionId], references: [id])
  sessionId      Int
  url            String
  domain         String
  pageCount      Int
  tier           Float
  issuesDetected String
  lighthouseJson String?
  contactEmail   String?
  status         String

  @@unique([sessionId, url])
}
